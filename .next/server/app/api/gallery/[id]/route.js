"use strict";(()=>{var e={};e.id=955,e.ids=[955],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},3292:e=>{e.exports=require("fs/promises")},2254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},7261:e=>{e.exports=require("node:util")},1017:e=>{e.exports=require("path")},6012:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>S,serverHooks:()=>m,staticGenerationAsyncStorage:()=>x});var n={};r.r(n),r.d(n,{DELETE:()=>g,PUT:()=>f});var s=r(9303),i=r(8716),o=r(670),a=r(7070),u=r(8569),c=r(6982),l=r(3292),d=r(1017),p=r.n(d);async function f(e,{params:t}){let r=await (0,c.k)(e);if(r)return r;try{let r=await e.json(),n={...r.alt&&{alt:r.alt},...r.tags&&{tags:r.tags}},s=(0,u.Fn)(t.id,n);if(!s)return a.NextResponse.json({success:!1,error:"Image not found"},{status:404});return a.NextResponse.json({success:!0,data:s})}catch(e){return console.error("Error updating image:",e),a.NextResponse.json({success:!1,error:"Failed to update image"},{status:500})}}async function g(e,{params:t}){let r=await (0,c.k)(e);if(r)return r;try{let e=(0,u.tS)(t.id);if(!e)return a.NextResponse.json({success:!1,error:"Image not found"},{status:404});let r=p().join(process.cwd(),"public",e.path);try{await (0,l.unlink)(r)}catch(e){console.error("Error deleting file:",e)}if(!(0,u.vX)(t.id))return a.NextResponse.json({success:!1,error:"Failed to delete image record"},{status:500});return a.NextResponse.json({success:!0,message:"Image deleted successfully"})}catch(e){return console.error("Error deleting image:",e),a.NextResponse.json({success:!1,error:"Failed to delete image"},{status:500})}}let S=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/gallery/[id]/route",pathname:"/api/gallery/[id]",filename:"route",bundlePath:"app/api/gallery/[id]/route"},resolvedPagePath:"/Users/baskoerhuis/jelte3D/app/api/gallery/[id]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:x,serverHooks:m}=S,w="/api/gallery/[id]/route";function h(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:x})}},6982:(e,t,r)=>{r.d(t,{k:()=>o});var n=r(7070),s=r(9178);async function i(e){let t=e.cookies.get("admin_token")?.value;return!!t&&null!==await (0,s.WX)(t)}async function o(e){return await i(e)?null:n.NextResponse.json({success:!1,error:"Unauthorized"},{status:401})}},9178:(e,t,r)=>{r.d(t,{T7:()=>d,V3:()=>u,WX:()=>c,xH:()=>p});var n=r(6091),s=r(6176),i=r(2023),o=r.n(i);let a=new TextEncoder().encode(process.env.JWT_SECRET||"your-secret-key-min-32-characters-long");async function u(e){return await new n.N(e).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").setIssuedAt().sign(a)}async function c(e){try{return(await (0,s._)(e,a)).payload}catch(e){return null}}async function l(e,t){return o().compare(e,t)}function d(){let e=process.env.ADMIN_PASSWORD_HASH||"";return process.env.ADMIN_PASSWORD_HASH_BASE64&&(e=Buffer.from(process.env.ADMIN_PASSWORD_HASH_BASE64,"base64").toString("utf-8")),e||(e="$2a$10$YourDefaultHashHere"),{username:process.env.ADMIN_USERNAME||"admin",passwordHash:e}}async function p(e,t){let r=d();return e===r.username&&l(t,r.passwordHash)}},8569:(e,t,r)=>{r.d(t,{Dg:()=>d,Fn:()=>w,GD:()=>N,Ir:()=>S,gk:()=>p,kK:()=>m,nM:()=>g,ry:()=>f,tS:()=>x,vR:()=>y,vX:()=>h});var n=r(7147),s=r.n(n),i=r(1017),o=r.n(i);let a=o().join(process.cwd(),"data"),u=o().join(a,"products.json"),c=o().join(a,"gallery.json");function l(){s().existsSync(a)||s().mkdirSync(a,{recursive:!0}),s().existsSync(u)||s().writeFileSync(u,JSON.stringify([])),s().existsSync(c)||s().writeFileSync(c,JSON.stringify([]))}function d(){l();try{let e=s().readFileSync(u,"utf-8");return JSON.parse(e)}catch(e){return[]}}function p(e){return d().find(t=>t.id===e)||null}function f(e){let t=d(),r={...e,id:A(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.push(r),s().writeFileSync(u,JSON.stringify(t,null,2)),r}function g(e,t){let r=d(),n=r.findIndex(t=>t.id===e);return -1===n?null:(r[n]={...r[n],...t,id:r[n].id,createdAt:r[n].createdAt,updatedAt:new Date().toISOString()},s().writeFileSync(u,JSON.stringify(r,null,2)),r[n])}function S(e){let t=d(),r=t.filter(t=>t.id!==e);return r.length!==t.length&&(s().writeFileSync(u,JSON.stringify(r,null,2)),!0)}function y(){l();try{let e=s().readFileSync(c,"utf-8");return JSON.parse(e)}catch(e){return[]}}function x(e){return y().find(t=>t.id===e)||null}function m(e){let t=y(),r={...e,id:A(),uploadedAt:new Date().toISOString()};return t.push(r),s().writeFileSync(c,JSON.stringify(t,null,2)),r}function w(e,t){let r=y(),n=r.findIndex(t=>t.id===e);return -1===n?null:(r[n]={...r[n],...t,id:r[n].id,uploadedAt:r[n].uploadedAt},s().writeFileSync(c,JSON.stringify(r,null,2)),r[n])}function h(e){let t=y(),r=t.filter(t=>t.id!==e);return r.length!==t.length&&(s().writeFileSync(c,JSON.stringify(r,null,2)),!0)}function A(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function N(e){return e.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972,391],()=>r(6012));module.exports=n})();